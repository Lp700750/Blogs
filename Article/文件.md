# 文件

### 0 前言

>对Linux OS有一些了解可能会听过这样一句话，Linux下一切皆文件，这句话足以表达出文件对于Linux OS有多么的重要，下面通过图解，从图形的角度来展现文件，帮助大家更好的理解它

### 1 文件的框图

>![](D:\PostgaduateStudies\有道云笔记\工作\文件系统.drawio.png)
>
>

### 2 框图解释

>如上图所示，（a）代表的是我们计算机当中的磁盘，磁盘里面有许多的圆盘(如图中的（b）所示)，圆盘里面有许多的同心圆，而每一个同心圆又可以分成很多部分，每一个部分放大就如图（c）所示，这个部分我们称作是扇区，磁盘的最小的存储单位叫做扇区*sector*,一般来说存储512个字节，但是操作系统在读取磁盘的时候，通常一次会读取8个*sector*，这个八个sector一我们又将其称作一个块区block，**一个块区block是文件的最小存储单位**。而每一个block就如图中的(d)所示。
>
>#### 2.1 各种名词解释
>
>- Super Block :存放文件系统本身的结构信息。记录的信息主要有: bolck和inode的总量,未使用的block和inode的数量，一个block和inode的大小,最近一次挂载的时间， 最近一次写入数据的时间，最近一次检验磁盘的时间等其他文件系统的相关信息。 Super Block的信息被破坏，可以说整个文件系统结构就被破坏了
>- Block Bitmap: Block Bitmap中记录着Data Block中哪个数据块已经被占用，哪个数据块没有被占用
>- inode Bitmap:每个bit表示一个inode是否空闲可用。
>- inode table:存放文件属性如文件大小，所有者,最近修改时间等
>- block data:存放文件内容

### **3 inode解释**

>- 一个inode里面会存放每个文件的各种信息.（存放着除文件名之外的所有文件信息)
>  - 文件的字节数	
>  - 文件拥有者的User ID
>  - 文件的Group ID
>  - 文件的读、写、执行权限
>  - 文件的时间戳，共有三个：ctime指inode上一次变动的时间，mtime指文件内容上一次变动的时间，atime指    文件上一次打开的时间。
>  - 链接数，即有多少文件名指向这个inode
>  - 文件数据block的位置 
>
>- 每一个inode都会有一个号码，系统会通过这个号码来识别不同的文件,这里需要注意，系统不会通过文件名来识别不同的文件(可以理解成系统只认识二进制)，文件名是inode号码的别名
>
>- 文件使用inode的步骤
>
>![](D:\PostgaduateStudies\编程资料\C++资料\博客文档\Linux操作系统\inode执行步骤.png)
>
>目录文件其实也是一种文件他的里面包含有如下的两个内容
>
>- 对应的文件名
>- 文件对应的inode号码

### 4 其他

>- 查看文件的*inode*  使用命令 *stat*
>
>```C++
>[Jolly.Roger@VM-16-9-centos lesson19]$ stat file.txt
>  File: ‘file.txt’
>  Size: 0         	Blocks: 0          IO Block: 4096   regular empty file
>Device: fd01h/64769d	Inode: 655936      Links: 1
>Access: (0664/-rw-rw-r--)  Uid: ( 1002/Jolly.Roger)   Gid: ( 1002/Jolly.Roger)
>Access: 2022-09-26 18:31:02.521845640 +0800
>Modify: 2022-09-26 18:31:02.521845640 +0800
>Change: 2022-09-26 18:31:34.519998527 +0800
> Birth: -
>```
>
>- **Access**： 文件最近越访问的时间
>- **Modify**:   最近一次修改文件内容的时间
>- **Change**:  最近一次修改文件属性的时间
>
>**硬链接**
>
>- 文件名和inode号码是对应关系
>- 但是linux操作系统允许多个文件名对应于一个inode号码，这种链接的方式叫做硬链接
>- 多个文件名可以访问同一个文件内容，对于每个文件内容得到修改都会影响每一个文件名，但是删除某个文件名，硬连接数会减少，但是不影响其他的文件名对这个文件的访问
>- 当硬连接数个数减为0的时候，OS会回收inode的号码和对应的block区域
>
>**软连接**
>
>- 文件A和文件B的inode号码不一样，但是A里面的内容是文件B的路径，读取文件的时候最终都会访问到B文件里面的内容，这种连接方式叫做软连接 



