# tcp可靠机制_3

### **流量控制**

>- 主机B的接收缓冲区处理数据是有限的，如果主机A发送缓冲区数据发得太快，接收缓冲区很快就被打满了，这个时候发送区再发送数据，数据会被丢弃，导致发送端需要重传数据，这样效率不高。
>
>- TCP会根据接收缓冲区的剩余缓冲区的大小，来决定发送数据的速度，这个机制叫做流量控制。
>
>- 接收端一旦发现自己的接收缓冲区快满了，就会将窗口大小设置成一个更小的值通知发送方。发送方接收到窗口大小后，会减慢自己的发送速度。
>
>- 如果接收缓冲区满了，就会将窗口设为0，这个时候发送方就不会发送数据，但是发送方怎么知道什么时候可以再发送数据呢？
>
>- 两种方法：两种方法是同时运行的。这都是内核做的，与上层无关。
>
>  方法一：
>
>  窗口探测，发送端隔一段时间，发送一个窗口探测数据段，让接收端响应回来字节的窗口大小。
>
>  方法二：
>
>  窗口更新通知：当接收方可以接收数据，会发送窗口更新通知给发送端。
>
>- 如果窗口探测多次，接收缓冲区还是满的，发送端可以发送带有PSH标志位的报文给接收端，催进程取数据。如果还是满的，说明是应用层程序有BUG

### 拥塞控制

>![image](https://github.com/Lp700750/Blogs/assets/104414865/ba9c9465-73f3-4b2c-919e-c83cfebb5c45)
>
>- 少量的数据报文丢失，采取超时重传可以补救，但是大量的数据丢失，就需要考虑阻塞控制了
>
>- 前面讲述的都是发送端和接收端的控制情况，但是数据再发送端到接收端还需要经过网络的传输，如果某一时刻网络当中非常的拥挤，如果此时我们还继续往网络里面发送大量的数据，势必会造成网络拥堵，更有可能将网络给冲垮。
>
>- 据此我们引入阻塞窗口的概念，与前面的滑动窗口和接收缓冲区的窗口大小不同，阻塞窗口代表的是一个整数。
>
>- 在发送端或者接收端发送一个ACK时，阻塞窗口就加上1
>
>- 在最开始阶段，发送端会采取慢开始的节奏，此时的阻塞窗口就会处于基值1，随着传输轮次的增加，阻塞窗口会呈现指数的增加，当增加到某一个阈值的时候，阻塞窗口变成正相关增加(避免阻塞快速增加)，如果不幸增加阻塞的阈值，此时网络阻塞发送的数据会阻塞在网络当中，使得接收端无法及时发送ACK给发送端，发送端就会隔一段时间进行超时重传，此时阻塞的阈值变成原先的一般，阻塞窗口变成1，该过程持续这样下去。
>
>- 阻塞控制的目的是为了缓解某一时刻网络中数据量太多而带来的压力
>
>- 发送端发送数据的大小一般是阻塞窗口与缓冲区16位窗口大小中的最小值
>
>- 在进行TCP 通信的时候，刚开始的时候网络的吞吐量是逐渐增加的，随着网络发生拥挤，吞吐量就会立刻下降
